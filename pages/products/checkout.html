<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>สรุปและยืนยันการสั่งซื้อ | YourSiteName</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.2/dist/sweetalert2.min.css">
    



<style>
:root {
    --primary-color: #E74C3C; /* แดงสดใส */
    --secondary-color: #F8C471; /* สีส้มอมเหลือง (ปรับให้เข้ากับแดง) */
    --danger-color: #C0392B; /* แดงเข้มขึ้นสำหรับเน้น */
    --text-color: #333333; /* สีเทาเข้ม */
    --light-gray: #F9F9F9; /* พื้นหลังเบาๆ */
    --medium-gray: #DDDDDD;
    --dark-gray: #666666;
    --white-color: #FFFFFF; /* สีขาวหลัก */
}
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3C/g%3E%3C/svg%3E");
    z-index: -1; 
    opacity: 0.5; 
}
* {
    box-sizing: border-box;
    font-family: 'Sarabun', sans-serif;
    margin: 0;
    padding: 0;
}
body {
    background: var(--light-gray);
    color: var(--text-color);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1.5rem; 
}
.checkout-wrapper {
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
    background: var(--white-color); 
    padding: 2.5rem;
    border-radius: 16px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.15); 
    display: flex;
    gap: 3rem; 
    flex-wrap: wrap;
    position: relative; 
    overflow: hidden; 
}
.checkout-wrapper::before,
.checkout-wrapper::after {
    content: '';
    position: absolute;
    width: 150px;
    height: 150px;
    opacity: 0.1;
    z-index: 0;
}
.checkout-wrapper::before { 
    top: -50px;
    right: -50px;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23E74C3C' fill-opacity='0.7' fill-rule='evenodd'%3E%3Ccircle cx='50' cy='50' r='50'/%3E%3C/g%3E%3C/svg%3E");
    background-size: cover;
    border-radius: 50%;
}
.checkout-wrapper::after { 
    bottom: -50px;
    left: -50px;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23E74C3C' fill-opacity='0.7' fill-rule='evenodd'%3E%3Crect width='100' height='100' rx='20'/%3E%3C/g%3E%3C/svg%3E");
    background-size: cover;
    transform: rotate(45deg);
}
h1 {
    font-size: 2.6rem; 
    margin-bottom: 2rem;
    text-align: center;
    color: var(--primary-color);
    font-weight: 700;
    width: 100%;
    position: relative;
    padding-bottom: 0.5rem;
}
h1::after { 
    content: '';
    display: block;
    width: 80px;
    height: 4px;
    background: var(--primary-color);
    margin: 0.5rem auto 0;
    border-radius: 2px;
}
.checkout-left, .checkout-right {
    flex: 1;
    min-width: 450px; 
    position: relative;
    z-index: 1; 
}
.order-summary-section, .customer-info-section {
    background-color: var(--white-color);
    border: 1px solid var(--medium-gray); 
    border-radius: 12px;
    padding: 2rem; 
    box-shadow: 0 6px 20px rgba(0,0,0,0.08); 
    margin-bottom: 1.5rem;
    position: relative;
}
.section-title {
    font-size: 1.8rem; 
    font-weight: 600;
    color: var(--primary-color); 
    margin-bottom: 1.5rem; 
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}
.section-title i {
    color: var(--primary-color); 
}
.item-list {
    margin-bottom: 1.5rem;
}
.item {
    display: flex;
    align-items: center;
    padding: 1rem 0; 
    border-bottom: 1px solid var(--medium-gray); /* ใช้เส้นทึบแทนเส้นประ */
    gap: 1rem;
}
.item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}
.item-image {
    width: 70px;
    height: 70px;
    object-fit: cover;
    border-radius: 8px;
    flex-shrink: 0;
    border: 1px solid var(--medium-gray);
}
.item-details {
    flex-grow: 1;
}
.item-name {
    font-weight: 600; 
    font-size: 1.2rem; 
    color: var(--text-color);
}
.item-quantity-price {
    font-size: 1rem; 
    color: var(--dark-gray);
}
.item-total {
    font-weight: 700; 
    color: var(--primary-color);
    font-size: 1rem; 
    white-space: nowrap;
}
.summary-totals {
    margin-top: 1.5rem;
    padding-top: 1.5rem; 
    border-top: 2px solid var(--medium-gray); 
}
.summary-totals p {
    display: flex;
    justify-content: space-between;
    margin: 0.8rem 0; 
    font-size: 1.1rem; 
}
.summary-totals p span:first-child {
    color: var(--dark-gray);
}
.summary-totals-price span {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
}



.customer-info-section label {
    display: block;
    margin-bottom: 0.6rem; 
    font-weight: 600; 
    color: var(--text-color); 
    font-size: 1rem;
}
.customer-info-section input[type="text"],
.customer-info-section input[type="email"],
.customer-info-section textarea {
    width: 100%;
    padding: 0.9rem; /* เพิ่ม padding */
    margin-bottom: 1.2rem; /* เพิ่ม margin */
    border: 1px solid var(--medium-gray);
    border-radius: 8px;
    font-size: 1.1rem; /* เพิ่มขนาดตัวอักษร */
    transition: border-color 0.3s, box-shadow 0.3s;
    background-color: var(--light-gray); /* พื้นหลัง input */
}

.customer-info-section input:focus,
.customer-info-section textarea:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2); /* เพิ่มเงาเมื่อ focus */
    outline: none;
    background-color: var(--white-color); /* พื้นหลังขาวเมื่อ focus */
}

.customer-info-section textarea {
    resize: vertical;
    min-height: 100px; /* เพิ่มความสูงเริ่มต้น */
}

.form-group {
    margin-bottom: 1.5rem; /* เพิ่ม margin */
}

.btn-place-order {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    width: 100%;
    padding: 1.3rem 2.5rem; /* เพิ่ม padding */
    background: var(--primary-color); /* แดงหลัก */
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 1.3rem; /* เพิ่มขนาดตัวอักษร */
    font-weight: 700; /* ตัวหนามาก */
    cursor: pointer;
    transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4); /* เงาแดง */
    margin-top: 2rem; /* เพิ่ม margin */
    letter-spacing: 0.5px; /* เพิ่มระยะห่างตัวอักษร */
}

.btn-place-order:hover {
    background: var(--danger-color); /* แดงเข้มขึ้น */
    transform: translateY(-3px); /* เลื่อนขึ้นเล็กน้อย */
    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.5);
}

.btn-goBack {
    display: block; /* ทำให้เป็น block level เพื่อควบคุม margin ได้ง่าย */
    text-align: center; /* จัดกลางเนื้อหาในปุ่ม (ไอคอน + ข้อความ) */
    margin-top: 1.5rem; /* ระยะห่างจากปุ่มด้านบน */
}

.btn-goBack a {
    display: inline-flex; /* ใช้ inline-flex เพื่อจัดเรียงไอคอนกับข้อความ */
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    width: 100%; /* ทำให้ลิงก์เต็มความกว้างของ parent div */
    padding: 1rem 2rem; /* padding ให้ปุ่มมีขนาดพอเหมาะ */
    background-color: transparent; /* ไม่มีพื้นหลัง */
    color: var(--primary-color); /* สีข้อความเป็นสีแดง */
    border: 2px solid var(--primary-color); /* เส้นขอบสีแดง */
    border-radius: 12px; /* มุมโค้งมน */
    font-size: 1.2rem; /* ขนาดตัวอักษร */
    font-weight: 600; /* ตัวหนา */
    text-decoration: none; /* ไม่มีขีดเส้นใต้ */
    cursor: pointer;
    transition: all 0.3s ease; /* transition เมื่อ hover */
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); /* เงาเล็กน้อย */
}

.btn-goBack a:hover {
    background-color: var(--primary-color); /* พื้นหลังสีแดงเมื่อ hover */
    color: var(--white-color); /* ข้อความเป็นสีขาวเมื่อ hover */
    transform: translateY(-2px); /* เลื่อนขึ้นเล็กน้อย */
    box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
}

.btn-goBack i {
    margin-right: 0; /* ไม่ต้องมี margin-right เพราะใช้ gap แล้ว */
}
/* --- สิ้นสุดปุ่ม "ย้อนกลับ" --- */


.empty-cart-message {
    text-align: center;
    font-size: 1.3rem; /* เพิ่มขนาด */
    color: var(--dark-gray);
    padding: 3rem 0;
    background-color: var(--light-gray);
    border-radius: 10px;
}


/* --- Responsive Styles --- */

/* Mobile (max-width: 480px) */
@media (max-width: 480px) {
    body {
        padding: 0.5rem;
    }
    .checkout-wrapper {
        padding: 1rem;
        border-radius: 10px;
        gap: 1.5rem; /* ลด gap ระหว่างคอลัมน์ */
        flex-direction: column; /* จัดเรียงคอลัมน์แนวตั้ง */
    }
    .checkout-left, .checkout-right {
        min-width: unset; /* ลบ min-width ออกเพื่อให้ใช้ได้เต็มความกว้าง */
        width: 100%; /* ให้เต็มความกว้างใน mobile */
    }
    .checkout-wrapper::before,
    .checkout-wrapper::after {
        width: 100px; /* ลดขนาด SVG Overlay */
        height: 100px;
        opacity: 0.08;
    }
    .checkout-wrapper::before {
        top: -30px;
        right: -30px;
    }
    .checkout-wrapper::after {
        bottom: -30px;
        left: -30px;
    }

    h1 {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
    }
    h1::after {
        width: 60px; /* ลดขนาดเส้นใต้ */
    }
    .section-title {
        font-size: 1.4rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
    }
    .order-summary-section, .customer-info-section {
        padding: 1.5rem; /* ลด padding ของ section */
        margin-bottom: 1rem;
    }
    .item-image {
        width: 50px; /* ลดขนาดรูปภาพสินค้า */
        height: 50px;
    }
    .item-name {
        font-size: 0.6rem;
    }
    .item-quantity-price {
        font-size: 0.45rem;
    }
    .item-total {
        font-size: 1.1rem;
    }
    .summary-totals {
        margin-top: 1rem;
        padding-top: 1rem;
    }
    .summary-totals p {
        font-size: 0.9rem;
        margin: 0.6rem 0;
    }
    .summary-totals strong {
        font-size: 1.3rem;
    }
    .customer-info-section label {
        font-size: 0.9rem;
        margin-bottom: 0.4rem;
    }
    .customer-info-section input[type="text"],
    .customer-info-section input[type="email"],
    .customer-info-section textarea {
        padding: 0.7rem;
        margin-bottom: 1rem;
        font-size: 0.8rem;
    }
    
    .summary-totals-price span {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--danger-color);
    }

    .customer-info-section textarea {
        min-height: 80px; 
    }
    .form-group {
        margin-bottom: 1rem;
    }
    .btn-place-order {
        font-size: 1.1rem;
        padding: 1rem 1.5rem;
        margin-top: 1.5rem;
    }
    .btn-goBack a {
        font-size: 1rem;
        padding: 0.8rem 1.2rem;
        margin-top: 1rem; /* ลด margin-top */
    }
    .empty-cart-message {
        font-size: 1rem;
        padding: 2rem 0;
    }
}







/* Tablet & iPad (min-width: 481px and max-width: 1024px) */
@media (min-width: 481px) and (max-width: 1024px) {
    body {
        padding: 1rem;
    }
    .checkout-wrapper {
        padding: 2rem; /* ปรับ padding ให้เหมาะสมกับ tablet */
        border-radius: 14px;
        flex-direction: column; /* จัดเรียงเป็นคอลัมน์เดียวใน Tablet/iPad */
        gap: 2rem;
    }
    .checkout-left, .checkout-right {
        min-width: unset; /* ลบ min-width ออก */
        width: 100%; /* ให้เต็มความกว้าง */
    }
    .checkout-wrapper::before,
    .checkout-wrapper::after {
        width: 120px; /* ปรับขนาด SVG Overlay */
        height: 120px;
        opacity: 0.09;
    }
    .checkout-wrapper::before {
        top: -40px;
        right: -40px;
    }
    .checkout-wrapper::after {
        bottom: -40px;
        left: -40px;
    }

    h1 {
        font-size: 2.2rem;
        margin-bottom: 1.8rem;
    }
    h1::after {
        width: 70px;
    }
    .section-title {
        font-size: 1.6rem;
        margin-bottom: 1.2rem;
        padding-bottom: 0.6rem;
    }
    .order-summary-section, .customer-info-section {
        padding: 1.8rem;
        margin-bottom: 1.2rem;
    }
    .item-image {
        width: 60px;
        height: 60px;
    }
    .item-name {
        font-size: 1.1rem;
    }
    .item-quantity-price {
        font-size: 1rem;
    }
    .item-total {
        font-size: 1.2rem;
    }
    .summary-totals {
        margin-top: 1.2rem;
        padding-top: 1.2rem;
    }
    .summary-totals p {
        font-size: 1rem;
        margin: 0.7rem 0;
    }
    .summary-totals strong {
        font-size: 1.4rem;
    }
    .customer-info-section label {
        font-size: 0.95rem;
        margin-bottom: 0.5rem;
    }
    .customer-info-section input[type="text"],
    .customer-info-section input[type="email"],
    .customer-info-section textarea {
        padding: 0.8rem;
        margin-bottom: 1.1rem;
        font-size: 1rem;
    }
    .customer-info-section textarea {
        min-height: 90px;
    }
    .form-group {
        margin-bottom: 1.2rem;
    }
    .btn-place-order {
        font-size: 1.2rem;
        padding: 1.1rem 2rem;
        margin-top: 1.8rem;
    }
    .btn-goBack a {
        font-size: 1.1rem;
        padding: 0.9rem 1.5rem;
        margin-top: 1.2rem;
    }
}
    </style>


        <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

</head>
<body>

    <div class="checkout-wrapper"> 
        <h1><i class="fas fa-shopping-cart"></i> ยืนยันการสั่งซื้อ</h1>

        <div class="checkout-left"> 
            <div class="order-summary-section">
                <h2 class="section-title"><i class="fas fa-box"></i> รายการสินค้า</h2>
                <div id="checkoutSummary" class="item-list">
                    <!-- รายการสินค้า -->
                </div>
                <div class="summary-totals">
                    <p><span>ราคารวมสินค้า (ไม่รวม VAT)</span><span id="subtotalExcludingVatDisplay"></span></p> 
                    <p><span>( ค่าสินค้ารวมค่าจัดส่ง )</span></p>
                    <p><span>ภาษีมูลค่าเพิ่ม (7%)</span><span id="vatAmountDisplay"></span></p><br>
                    <p class="summary-totals-price"><span>ยอดชำระทั้งหมด (รวม VAT) </span><span id="grandTotalDisplay"></span></p>
                </div>
            </div>
        </div>

        <div class="checkout-right"> 
            <div class="customer-info-section">
                <h2 class="section-title"><i class="fas fa-user-check"></i> กรอกข้อมูลที่อยู่จัดส่ง</h2>
                <div class="form-group">
                    <label>พื้นที่:</label>
                    <p id="selectedDeliveryArea" style="font-weight: bold; color: var(--text-color);"></p>
                </div>
                
                <form id="customerOrderForm">
                    <div class="form-group">
                        <label for="customerName">ชื่อ-นามสกุล:</label>
                        <input type="text" id="customerName" name="customerName" placeholder="เช่น สมชาย ใจดี" required>
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">อีเมล:</label>
                        <input type="email" id="customerEmail" name="customerEmail" placeholder="เช่น somchai1775@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="customerTaxID">เลขที่ผู้เสียภาษี (ถ้ามี):</label>
                        <input type="text" id="customerTaxID" name="customerTaxID" placeholder="เช่น XXX-XXXXXXXX" >
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">เบอร์ติดต่อ:</label>
                        <input type="text" id="customerPhone" name="customerPhone" placeholder="เช่น 08XXXXXXXX" required>
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">ที่อยู่ผู้ซื้อ:</label>
                        <textarea id="customerAddress" name="customerAddress" placeholder="บ้านเลขที่, ถนน, ตำบล/แขวง, อำเภอ/เขต, จังหวัด, รหัสไปรษณีย์" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="customerAddressToSend">ที่อยู่ปลายทางสำหรับจัดส่ง:</label>
                        <textarea id="customerAddressToSend" name="customerAddressToSend" placeholder="บ้านเลขที่, ถนน, ตำบล/แขวง, อำเภอ/เขต, จังหวัด, รหัสไปรษณีย์"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="deliveryNotes">ข้อความเพิ่มเติม</label>
                        <textarea id="deliveryNotes" name="deliveryNotes" placeholder="เช่น ช่วงเวลาที่สะดวกรับสินค้า, รายละเอียดการจัดส่งเฉพาะ"></textarea>
                    </div>

                   
                    <button type="submit" class="btn-place-order" id="placeOrderBtn">
                        <i class="fas fa-money-check-alt"></i> ดำเนินการต่อ
                    </button>

                    <div class="btn-goBack" id="placeOrderBtn">
                        <a href="/pages/products/products_showall.html">                        
                            <i class="fa-solid fa-arrow-left"></i> ยกเลิก
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.2/dist/sweetalert2.all.min.js"></script>

<script>
    
    let itemsToCheckout = [];
    let deliveryAreaDisplayData = { province: "", district: "" };

    document.addEventListener("DOMContentLoaded", () => {
        const buyNowItemData = localStorage.getItem("buyNowItem");
        const checkoutCartData = localStorage.getItem("checkoutCartItems");

        if (buyNowItemData) {
            const parsedItem = JSON.parse(buyNowItemData);
          
            parsedItem.qty = parsedItem.quantity;
            itemsToCheckout = [parsedItem];
            deliveryAreaDisplayData.province = parsedItem.province || "";
            deliveryAreaDisplayData.district = parsedItem.district || "";
        } else if (checkoutCartData) {
            itemsToCheckout = JSON.parse(checkoutCartData);
            if (itemsToCheckout.length > 0) {
                deliveryAreaDisplayData.province = itemsToCheckout[0].province || "";
                deliveryAreaDisplayData.district = itemsToCheckout[0].district || "";
            }
        }

        const deliveryAreaDisplay = document.getElementById("selectedDeliveryArea");
        if (deliveryAreaDisplayData.province && deliveryAreaDisplayData.district && deliveryAreaDisplayData.province !== "" && deliveryAreaDisplayData.district !== "") {
            deliveryAreaDisplay.textContent = `${deliveryAreaDisplayData.province}, ${deliveryAreaDisplayData.district}`;
        } else {
            deliveryAreaDisplay.textContent = "ไม่ได้ระบุพื้นที่จัดส่ง (อาจต้องกลับไปเลือกสินค้าใหม่)";
        }

        if (itemsToCheckout.length > 0) {
            renderCheckoutSummary(itemsToCheckout);
        } else {
            document.getElementById("checkoutSummary").innerHTML = `
                <div class="empty-cart-message">
                    <i class="fas fa-info-circle" style="margin-right: 10px;"></i> ไม่พบสินค้าสำหรับการสั่งซื้อ
                </div>
            `;
            document.getElementById("subtotalExcludingVatDisplay").textContent = "0 บาท";
            document.getElementById("vatAmountDisplay").textContent = "0 บาท";
            document.getElementById("grandTotalDisplay").textContent = "0 บาท";
            document.getElementById("placeOrderBtn").disabled = true;
        }
    });

    function formatPrice(price) {
        if (typeof price !== 'number' || isNaN(price)) {
            return 'N/A';
        }
        return parseFloat(price.toFixed(2)).toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }


    function renderCheckoutSummary(items) {
        const summaryDiv = document.getElementById("checkoutSummary");
        let html = "";
        let totalIncludingVat = 0;

        items.forEach(item => {
            const quantity = item.qty !== undefined && !isNaN(item.qty) ? item.qty : 1;
            const pricePerUnitIncludingVat = parseFloat(item.price) || 0;
            const itemTotalIncludingVat = pricePerUnitIncludingVat * quantity;

            const qtyPerSet = parseInt(item.quantity) || 1;
            const minimumQty = parseInt(item.minimum) || 1;
            const unitLabel = item.unit || 'ชิ้น';

            const setCount = Math.floor(quantity / qtyPerSet); // แก้ไขจาก Math.round
            const setLabel = item.type === 'truck' ? 'รถบรรทุก' : 'รถบรรทุก'; 

            const deliveryText = item.delivery || 'ไม่ระบุ';

            html += `
                <div class="item">
                    <img src="/assets/images/products/${item.image || ''}" alt="${item.name}" class="item-image">
                    <div class="item-details">
                        <div class="item-name">${item.name}</div>
                        <div class="item-quantity-price">${formatPrice(pricePerUnitIncludingVat)} บาท/${unitLabel}</div>
                        <div class="item-quantity-summary">
                            <span class="set-count">จำนวน ${setCount} ${setLabel}</span>
                            <span class="total-units">(รวม ${quantity} ${unitLabel})</span>
                            <br>
                        </div>
                    </div>
                    <div class="item-total">${formatPrice(itemTotalIncludingVat)} บาท</div>
                </div>
            `;
            totalIncludingVat += itemTotalIncludingVat;
        });

        const totalExcludingVat = (totalIncludingVat === 0 || isNaN(totalIncludingVat)) ? 0 : totalIncludingVat / 1.07;
        const vatAmount = (totalIncludingVat === 0 || isNaN(totalIncludingVat)) ? 0 : totalIncludingVat - totalExcludingVat;

        summaryDiv.innerHTML = html;
        document.getElementById("subtotalExcludingVatDisplay").textContent = `${formatPrice(totalExcludingVat)} บาท`;
        document.getElementById("vatAmountDisplay").textContent = `${formatPrice(vatAmount)} บาท`;
        document.getElementById("grandTotalDisplay").textContent = `${formatPrice(totalIncludingVat)} บาท`;

        if (items.length > 0) {
            document.getElementById("placeOrderBtn").disabled = false;
        }
    }

    document.getElementById("customerOrderForm").addEventListener("submit", (event) => {
    event.preventDefault(); 

    const customerName = document.getElementById("customerName").value;
    const customerEmail = document.getElementById("customerEmail").value;
    const customerTaxID = document.getElementById("customerTaxID").value;
    const customerPhone = document.getElementById("customerPhone").value;
    const customerAddress = document.getElementById("customerAddress").value;
    const customerAddressToSend = document.getElementById("customerAddressToSend").value;
    const deliveryNotes = document.getElementById("deliveryNotes").value;
    
    const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value || 'bankTransfer'; 

    if (!customerName || !customerEmail || !customerPhone || !customerAddress) {
        Swal.fire({
            icon: 'warning',
            title: 'ข้อมูลไม่ครบถ้วน',
            text: 'กรุณากรอกข้อมูลผู้ติดต่อและที่อยู่สำหรับออกบิลให้ครบถ้วน',
            confirmButtonText: 'ตกลง'
        });
        return;
    }

    if (itemsToCheckout.length === 0) {
        Swal.fire({
            icon: 'error',
            title: 'ไม่พบสินค้า',
            text: 'ไม่พบสินค้าที่จะสั่งซื้อ กรุณาเลือกสินค้าก่อนดำเนินการ',
            confirmButtonText: 'ตกลง'
        });
        return;
    }

    let totalIncludingVat = 0;
    itemsToCheckout.forEach(item => {
        const quantity = (item.quantity !== undefined && !isNaN(item.quantity)) ? item.quantity : (item.qty !== undefined && !isNaN(item.qty) ? item.qty : 1);
        totalIncludingVat += (parseFloat(item.price) || 0) * quantity;
    });
    
    const totalExcludingVat = (totalIncludingVat === 0 || isNaN(totalIncludingVat)) ? 0 : totalIncludingVat / 1.07;
    const vatAmount = (totalIncludingVat === 0 || isNaN(totalIncludingVat)) ? 0 : totalIncludingVat - totalExcludingVat;

    const orderDetails = {
        customer: {
            name: customerName,
            email: customerEmail,
            taxId: customerTaxID,
            phone: customerPhone,
            billingAddress: customerAddress,
            shippingAddress: customerAddressToSend,
            notes: deliveryNotes, 
            deliveryProvince: deliveryAreaDisplayData.province,
            deliveryDistrict: deliveryAreaDisplayData.district
        },
        items: itemsToCheckout.map(item => ({ 
            id: item.id,
            name: item.name,
            image: item.image,
            weight: item.weight,
            price: parseFloat(item.price) || 0,             
            quantity: (item.qty !== undefined && !isNaN(item.qty)) ? item.qty : (item.quantity !== undefined && !isNaN(item.quantity) ? item.quantity : 1),      
            unit: item.unit,
            delivery: item.delivery, 
            type: item.type,
            minimum: item.minimum
        })),
        paymentMethod: paymentMethod,
        subtotalExcludingVat: totalExcludingVat,
        vatAmount: vatAmount,
        grandTotalIncludingVat: totalIncludingVat,
        timestamp: new Date().toISOString()
    };

    localStorage.setItem("orderDetails", JSON.stringify(orderDetails));

    console.log("Order Details for Confirmation Page:", orderDetails);

    localStorage.removeItem("checkoutCartItems");
    localStorage.removeItem("buyNowItem");
    Swal.fire({
        icon: 'success',
        title: 'สำเร็จ',
        text: 'ไปยังหน้าชำระเงิน...',
        showConfirmButton: false,
        timer: 1000,
        timerProgressBar: true,
        didOpen: () => {
            Swal.showLoading(); 
        }
    }).then(() => {
        window.location.href = '/pages/order-confirmation.html';
    });
});

</script>



</body>
</html>